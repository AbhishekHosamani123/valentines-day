# Supabase Setup Guide for Your Secret Data Form

To make your form save data online, follow these steps to set up a free Supabase project.

## Step 1: Create a Project
1.  Go to [supabase.com](https://supabase.com/) and click **"Start your project"**.
2.  Sign in with GitHub (you already use it!).
3.  Click **"New Project"**.
4.  Give it a name (e.g., `GubbiSecrets`).
5.  Set a database password (remember it!).
6.  Choose a region close to you.
7.  Click **"Create new project"**.

## Step 2: Get Your API Keys
1.  Once your project is ready (it takes a minute), find the **Settings** icon (cogwheel) at the bottom of the left sidebar.
2.  Click on **"API"**.
3.  Look for the **Project URL** and **anon public** key.
4.  **Copy these!** You will need to paste them into your `index.html` file later.

## Step 3: Create the Database Table (The Easy Way)
Instead of clicking buttons, let's run a small code snippet to create your table perfectly.

1.  Click on the **SQL Editor** icon (looks like `>_` or a terminal) in the left sidebar.
2.  Paste the following code into the editor:

```sql
create table secrets (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  name text,
  message text,
  photo_urls text[]
);
```

3.  Click **Run** (bottom right).
4.  You should see "Success" in the results area. 
    *   *Note: If you already created a partial table, you might need to delete it first from the Table Editor.*

## Step 4: Create the Storage Bucket for Photos
1.  Click on the **Storage** icon (folder/files) in the left sidebar.
2.  Click **"New Bucket"**.
3.  Name it: `photos`.
4.  Make it **Public** (switch the toggle to "Public bucket").
5.  Click **"Save"**.

## Step 5: Configure Email Verification URLs
Since you want to use **Email Verification**, you need to tell Supabase where to redirect users after they click "Confirm Account" in their email.

1.  Click on the **Authentication** icon (looks like a users group) in the left sidebar.
2.  Click on **URL Configuration** under Configuration.
3.  Set **Site URL** to: `http://localhost:3000` (since you are running the main app there).
4.  Click **Save**.

**How it works:**
1.  You sign up in the form.
2.  Supabase sends an email.
3.  You click the link -> it verifies you -> it redirects you to the Birthday Website (localhost:3000).
4.  **Crucial:** After clicking the link and seeing the website, **close that tab and go back to your Form**.
5.  Now you can **Login** with your email and password!

## Troubleshooting: Email Not Arriving? ðŸ“§
If you signed up but didn't get an email:

1.  **Check Spam Folder**: It often lands there.
2.  **Wait 5 Minutes**: Sometimes delivery is slow.
3.  **Rate Limit**: The free version of Supabase only allows **3 emails per hour**. If you tried too many times, you are blocked for an hour.

**The "Emergency" Fix (Manual Confirmation):**
If you are stuck, you (as the admin) can manually confirm the user:
1.  Go to **Auhentication** -> **Users** in Supabase.
2.  Find the email address in the list.
3.  Click the **three dots** (...) next to the user.
4.  Click **"Confirm User"** (or "Verify User").
5.  Now the user can log in immediately with their password!


## Troubleshooting: "new row violates row-level security policy" ðŸ”’
If you see this error, it means Supabase is blocking your uploads because it doesn't have permission rules set up.

**The Complete Fix (Run this in SQL Editor):**
This script fixes permissions for BOTH your **Database** (text) and **Storage** (photos).

1.  Go to **SQL Editor** in Supabase.
2.  **Paste and Run this exactly:**

```sql
-- 1. Enable RLS on the table
alter table secrets enable row level security;

-- 2. Allow logged-in users to INSERT data into the table
create policy "Allow authenticated uploads"
on secrets
for insert
to authenticated
with check (true);

-- 3. Allow logged-in users to SEE their data (optional)
create policy "Allow authenticated view"
on secrets
for select
to authenticated
using (true);

-- 4. Allow logged-in users to UPLOAD photos to the 'photos' bucket
create policy "Allow authenticated photo uploads"
on storage.objects
for insert
to authenticated
with check (bucket_id = 'photos');

-- 5. Allow public to VIEW photos (already done if bucket is public, but good to be safe)
create policy "Allow public photo viewing"
on storage.objects
for select
to public
using (bucket_id = 'photos');
```

3.  Click **Run**.
4.  If it says "Success" or "Policy already exists" (ignore errors if it says already exists), you are good!
5.  Try submitting the form again! ðŸš€

## Step 6: View Your Data ðŸ“Š
Once you submit the form, here is how you see the data:

### To See Text (Names & Messages):
1.  Click on the **Table Editor** icon (spreadsheet) in the left sidebar.
2.  Click on the `secrets` table.
3.  You will see rows for every submission!
4.  The `photo_urls` column will contain links to the photos. You can copy-paste them to view.

### To See Photos (Gallery):
1.  Click on the **Storage** icon (folder/files) in the left sidebar.
2.  Click on your `photos` bucket.
3.  You will see all the uploaded images there!
4.  You can click any image to preview or download it.
